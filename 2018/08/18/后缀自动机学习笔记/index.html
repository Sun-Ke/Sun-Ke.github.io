

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head><!-- hexo injector head_begin start --><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js" integrity="sha512-EKW5YvKU3hpyyOcN6jQnAxO/L8gts+YdYV6Yymtl8pk9YlYFtqJgihORuRoBXK8/cOIlappdU6Ms8KdK6yBCgA==" crossorigin="anonymous" referrerpolicy="no-referrer"> </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css"><script src = "https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script> <!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg">
  <link rel="icon" href="/img/avatar.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="forever_you">
  <meta name="keywords" content="">
  
    <meta name="description" content="写在前面推荐hihocoder上的讲解，可以说是十分清楚了。 用好后缀自动机不是十分容易，但看完本文的总结应该能至少达到签到水平…">
<meta property="og:type" content="article">
<meta property="og:title" content="后缀自动机学习笔记">
<meta property="og:url" content="https://izard.space/2018/08/18/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Forever you~">
<meta property="og:description" content="写在前面推荐hihocoder上的讲解，可以说是十分清楚了。 用好后缀自动机不是十分容易，但看完本文的总结应该能至少达到签到水平…">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://izard.space/img/sam.jpg">
<meta property="article:published_time" content="2018-08-18T07:15:00.000Z">
<meta property="article:modified_time" content="2020-08-24T06:47:20.000Z">
<meta property="article:author" content="forever_you">
<meta property="article:tag" content="后缀自动机">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://izard.space/img/sam.jpg">
  
  
  
  <title>后缀自动机学习笔记 - Forever you~</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"izard.space","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Forever you~" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Forever you~</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="后缀自动机学习笔记"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2018-08-18 15:15" pubdate>
          2018年8月18日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7k 字
        
      </span>
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">后缀自动机学习笔记</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a><strong>写在前面</strong></h2><p>推荐<a target="_blank" rel="noopener" href="http://hihocoder.com/contest/hiho127/problem/1">hihocoder</a>上的讲解，可以说是十分清楚了。</p>
<p>用好后缀自动机不是十分容易，但看完本文的总结应该能至少达到签到水平…</p>
<span id="more"></span>

<hr>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>后缀自动机（Suffix Automaton，简称SAM）。对于一个字符串S，它对应的后缀自动机是一个最小的确定有限状态自动机（DFA），接受且只接受S的后缀。</p>
<p>先给出一张图和一个表格。</p>
<p>对于字符串STR&#x3D;”aabbabd”，它的后缀自动机是：</p>
<center><img src="/img/sam.jpg" srcset="/img/loading.gif" lazyload width="90%"></center>

<table>
<thead>
<tr>
<th>状态</th>
<th>子串</th>
<th>endpos</th>
</tr>
</thead>
<tbody><tr>
<td>S</td>
<td>空串</td>
<td>{0,1,2,3,4,5,6}</td>
</tr>
<tr>
<td>1</td>
<td>a</td>
<td>{1,2,5}</td>
</tr>
<tr>
<td>2</td>
<td>aa</td>
<td>{2}</td>
</tr>
<tr>
<td>3</td>
<td>aab</td>
<td>{3}</td>
</tr>
<tr>
<td>4</td>
<td>aabb,abb,bb</td>
<td>{4}</td>
</tr>
<tr>
<td>5</td>
<td>b</td>
<td>{3,4,6}</td>
</tr>
<tr>
<td>6</td>
<td>aabba,abba,bba,ba</td>
<td>{5}</td>
</tr>
<tr>
<td>7</td>
<td>aabbab,abbab,bbab,bab</td>
<td>{6}</td>
</tr>
<tr>
<td>8</td>
<td>ab</td>
<td>{3,6}</td>
</tr>
<tr>
<td>9</td>
<td>aabbabd,abbabd,bbabd,babd,abd,bd,d</td>
<td>{7}</td>
</tr>
</tbody></table>
<p>接下来从状态(State)、转移函数(Transition Function)、后缀链接(Suffix Link)三个方面全方位了解一下后缀自动机的性质。</p>
<h3 id="状态："><a href="#状态：" class="headerlink" title="状态："></a>状态：</h3><p>记号：</p>
<ul>
<li>$length(s)$表示字符串 $s$ 的长度。</li>
<li>$endpos(s)$表示字符串 $s$ 在 $STR$ 中所有出现的结束位置集合。</li>
<li>$substrings(st)$表示状态 $st$ 中包含的所有子串的集合。</li>
<li>$longest(st)$表示状态 $st$ 包含的最长的子串，$shortest(st)$表示 $st$ 包含的最短的子串。</li>
<li>$maxlen(st)&#x3D;length(longest(st))$。</li>
</ul>
<p>性质:</p>
<ul>
<li>从起始状态 $S$ 出发，沿着图中蓝线转移，对于 $STR$ 的子串最终会到达一个合法状态，不是子串的话最终会无路可走。</li>
<li>对于 $STR$ 的两个子串 $s_1$ 和 $s_2$，不妨设$length(s_1) \leq length(s_2)$，$s_1$ 是 $s_2$ 的后缀当且仅当$endpos(s_2) \subseteq endpos(s_1)$，$s_1$不是$s_2$的后缀当且仅当$endpos(s_1) \bigcap endpos(s_2) &#x3D; \emptyset$</li>
<li>对于一个后缀自动机的状态 $st$，$substrings(st)$ 里的字符串 $endpos$ 集都相同，或者说同一个状态下的字符串构成了一个等价类，这样记 $endpos(st)$ 表示该状态的 $endpos$ 集。</li>
<li>对于一个后缀自动机的状态 $st$，以及任意 $s \in substrings(st)$，都有 $s$ 是 $longest(st)$ 的后缀。</li>
<li>对于一个状态 $st$，以及任意的 $longest(st)$ 的后缀 $s$，如果 $s$ 的长度满足：$length(shortest(st)) \leq length(s) \leq length(longsest(st))$，那么 $s \in substrings(st)$。</li>
<li>换句话说，$substrings(st)$ 包含的是 $longest(st)$ 的一系列连续后缀。</li>
</ul>
<h3 id="转移函数："><a href="#转移函数：" class="headerlink" title="转移函数："></a>转移函数：</h3><ul>
<li>记字符集合$next(st)$表示对于一个状态 $st$ ，从它开始下一个遇到的字符可能有哪些，形式化的写出来，有 $next(st) &#x3D; {STR[i+1] \mid i \in endpos(st)}$ 。对于一个状态 $st$ 来说和一个$next(st)$中的字符c，你会发现$substrings(st)$中的所有子串后面接上一个字符c之后，新的子串仍然都属于同一个状态。比如对于状态4，$next(4)&#x3D;{a}$，aabb,abb,bb后面接上字符a得到aabba，abba，bba，这些子串都属于状态6。</li>
<li>定义转移函数 $trans(st, c) &#x3D; x \mid longest(st) + c \in substrings(x)$ 。换句话说，我们在$longest(st)$ 后面接上一个字符c得到一个新的子串 $s$ （随便哪个子串都会得到相同的结果），找到包含 $s$ 的状态 $x$，那么 $trans(st, c)$ 就等于$x$。</li>
<li>对应图中蓝线，比如 $trans(4, a)&#x3D;6$。</li>
</ul>
<h3 id="后缀链接："><a href="#后缀链接：" class="headerlink" title="后缀链接："></a>后缀链接：</h3><ul>
<li>前面我们讲到$substrings(st)$包含的是$longest(st)$的一系列连续后缀。这连续的后缀在某个地方会“断掉”。比如状态7，包含的子串依次是aabbab,abbab,bbab,bab。按照连续的规律下一个子串应该是“ab”，但是“ab”没在状态7里，这是因为串变短了，就有可能在别的地方也会出现，即$endpos$集合大小变大了。比如aabbab,abbab,bbab,bab（状态7）的$endpos$集为{6}，而“ab”（状态8）的$endpos$集为{3,6}，“b”（状态5）的$endpos$集为{3,4,6}。</li>
<li>于是我们可以发现一条状态序列：7-&gt;8-&gt;5-&gt;S。这个序列的意义是 $longest(7)$ 即aabbab的后缀依次在状态7、8、5、S中。我们用Suffix Link这一串状态链接起来，这条link就是上图中的绿色虚线。</li>
<li>后缀链接组成了一棵以S为根的树。</li>
</ul>
<h3 id="构造后缀自动机："><a href="#构造后缀自动机：" class="headerlink" title="构造后缀自动机："></a>构造后缀自动机：</h3><p>构造比较复杂，还是推荐看 <a target="_blank" rel="noopener" href="http://hihocoder.com/contest/hiho128/problem/1">http://hihocoder.com/contest/hiho128/problem/1</a></p>
<p>~~具体改天再写~~~</p>
<p>时间复杂度 $O(N)$ ，空间上状态数不超过 $2N$。</p>
<p>代码中 <code>son</code> 表示转移函数，<code>pre</code> 表示后缀链接，<code>cnt</code> 表示 $endpos$ 集合大小。</p>
<p>添加字符的过程中只能标出 $endpos$ 大小为 $1$ 的那些状态，需要对后缀链接构成的树形结构从叶子开始做拓扑排序，得到所有状态的 $endpos$ 集合大小。</p>
<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 1000010</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SAM</span><br>&#123;<br>    <span class="hljs-type">int</span> tot,last;<br>    <span class="hljs-type">int</span> son[N&lt;&lt;<span class="hljs-number">1</span>][<span class="hljs-number">26</span>],maxlen[N&lt;&lt;<span class="hljs-number">1</span>],pre[N&lt;&lt;<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> cnt[N&lt;&lt;<span class="hljs-number">1</span>],in[N&lt;&lt;<span class="hljs-number">1</span>],q[N&lt;&lt;<span class="hljs-number">1</span>];<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        tot=<span class="hljs-number">0</span>;<br>        last=<span class="hljs-built_in">newnode</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">newnode</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        ++tot;<br>        <span class="hljs-built_in">memset</span>(son[tot],<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(son[tot]));<br>        maxlen[tot]=pre[tot]=cnt[tot]=in[tot]=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> tot;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> now=<span class="hljs-built_in">newnode</span>();<br>        maxlen[now]=maxlen[last]+<span class="hljs-number">1</span>;<br>        cnt[now]=<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span>(last &amp;&amp; son[last][c]==<span class="hljs-number">0</span>)<br>            son[last][c]=now,last=pre[last];<br>        <span class="hljs-keyword">if</span>(last)<br>        &#123;<br>            <span class="hljs-type">int</span> x=son[last][c];<br>            <span class="hljs-keyword">if</span>(maxlen[x]==maxlen[last]+<span class="hljs-number">1</span>) pre[now]=x;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-type">int</span> nq=<span class="hljs-built_in">newnode</span>();<br>                maxlen[nq]=maxlen[last]+<span class="hljs-number">1</span>;<br>                <span class="hljs-built_in">memcpy</span>(son[nq],son[x],<span class="hljs-built_in">sizeof</span>(son[x]));<br>                pre[nq]=pre[x];<br>                pre[x]=pre[now]=nq;<br>                <span class="hljs-keyword">while</span>(last &amp;&amp; son[last][c]==x)<br>                    son[last][c]=nq,last=pre[last];<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> pre[now]=<span class="hljs-number">1</span>;<br>        last=now;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">endpos</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> l=<span class="hljs-number">0</span>,r=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=tot;++i) ++in[pre[i]];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=tot;++i)<br>            <span class="hljs-keyword">if</span>(!in[i])<br>                q[r++]=i;<br>        <span class="hljs-keyword">while</span>(l!=r)<br>        &#123;<br>            <span class="hljs-type">int</span> x=q[l++];<br>            <span class="hljs-keyword">if</span>(pre[x]==<span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br>            cnt[pre[x]]+=cnt[x];<br>            <span class="hljs-keyword">if</span>((--in[pre[x]])==<span class="hljs-number">0</span>)<br>                q[r++]=pre[x];<br>        &#125;<br>    &#125;<br>&#125; sam;<br><span class="hljs-type">char</span> s[N];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    sam.<span class="hljs-built_in">init</span>();<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,s);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;s[i];++i) sam.<span class="hljs-built_in">add</span>(s[i]-<span class="hljs-string">&#x27;a&#x27;</span>);<br>    sam.<span class="hljs-built_in">endpos</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="广义后缀自动机"><a href="#广义后缀自动机" class="headerlink" title="广义后缀自动机"></a>广义后缀自动机</h3><p>解决多个串的问题，做法很简单，只需要添加每个串前让last&#x3D;1即可，或者也可以对trie树建后缀自动机，则新加点时last为trie上的父节点。分析与证明在2015年国家集训队论文里有。</p>
<p>如果要记录一些信息，比如strval表示每个状态里的子串在多少个串中出现过，需要额外加一个lc维护该状态上一次出现是哪个串，每次沿着Parent向上更新出现次数，遇到lc&#x3D;当前串的就停止。<del>时间复杂度还不太会分析，待补。</del></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> id,<span class="hljs-type">int</span> c)</span><span class="hljs-comment">//id表示第几个串，编号从1开始</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> now=<span class="hljs-built_in">newnode</span>();<br>    maxlen[now]=maxlen[last]+<span class="hljs-number">1</span>;<br>    cnt[now]=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span>(last &amp;&amp; son[last][c]==<span class="hljs-number">0</span>)<br>        son[last][c]=now,last=pre[last];<br>    <span class="hljs-keyword">if</span>(last)<br>    &#123;<br>        <span class="hljs-type">int</span> x=son[last][c];<br>        <span class="hljs-keyword">if</span>(maxlen[x]==maxlen[last]+<span class="hljs-number">1</span>) pre[now]=x;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-type">int</span> nq=<span class="hljs-built_in">newnode</span>();<br>            maxlen[nq]=maxlen[last]+<span class="hljs-number">1</span>;<br>            <span class="hljs-built_in">memcpy</span>(son[nq],son[x],<span class="hljs-built_in">sizeof</span>(son[x]));<br>            pre[nq]=pre[x];<br>            lc[nq]=lc[x];strval[nq]=strval[x];<span class="hljs-comment">//额外的信息</span><br>            pre[x]=pre[now]=nq;<br>            <span class="hljs-keyword">while</span>(last &amp;&amp; son[last][c]==x)<br>                son[last][c]=nq,last=pre[last];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> pre[now]=<span class="hljs-number">1</span>;<br>    last=now;<br>    <span class="hljs-comment">//广义后缀自动机</span><br>    <span class="hljs-keyword">while</span>(now &amp;&amp; lc[now]!=id)<br>    &#123;<br>        lc[now]=id;<br>        ++strval[now];<br>        now=pre[now];<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//main</span><br><br>sam.<span class="hljs-built_in">init</span>();<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)<br>&#123;<br>    sam.last=<span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,s);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;s[j];++j) sam.<span class="hljs-built_in">add</span>(i,s[j]-<span class="hljs-string">&#x27;a&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="练习题目："><a href="#练习题目：" class="headerlink" title="练习题目："></a>练习题目：</h3><h4 id="1-hihocoder-1445-后缀自动机二·重复旋律5"><a href="#1-hihocoder-1445-后缀自动机二·重复旋律5" class="headerlink" title="1.hihocoder #1445 : 后缀自动机二·重复旋律5"></a>1.<a target="_blank" rel="noopener" href="http://hihocoder.com/problemset/problem/1445">hihocoder #1445 : 后缀自动机二·重复旋律5</a></h4><p><strong>求字符串本质不同子串的个数</strong>，直接累加$\left|substrings(st) \right|$，利用maxlen数组及suffix link不难得出。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">ll <span class="hljs-title">count</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ll ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=tot;++i)<br>        ans+=maxlen[i]-maxlen[pre[i]];<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="2-spoj1811-LCS"><a href="#2-spoj1811-LCS" class="headerlink" title="2.spoj1811 LCS"></a>2.<a target="_blank" rel="noopener" href="https://vjudge.net/problem/SPOJ-LCS">spoj1811 LCS</a></h4><p><strong>求两个串最长公共子串</strong>，对一个串建后缀自动机，另一个串在上面走，如果当前状态没有当前字符的转移，就沿着suffix link往回跳，很好理解。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">LCS</span><span class="hljs-params">(<span class="hljs-type">char</span> *s)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> now=<span class="hljs-number">1</span>,len=<span class="hljs-number">0</span>,ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;s[i];++i)<br>    &#123;<br>        <span class="hljs-type">int</span> x=s[i]-<span class="hljs-string">&#x27;a&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(son[now][x])<br>            ++len,now=son[now][x];<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">while</span>(now &amp;&amp; son[now][x]==<span class="hljs-number">0</span>) now=pre[now];<br>            <span class="hljs-keyword">if</span>(now==<span class="hljs-number">0</span>) len=<span class="hljs-number">0</span>,now=<span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">else</span> len=maxlen[now]+<span class="hljs-number">1</span>,now=son[now][x];<br>        &#125;<br>        ans=<span class="hljs-built_in">max</span>(ans,len);<br>    &#125;<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-bzoj3998-TJOI2015-弦论"><a href="#3-bzoj3998-TJOI2015-弦论" class="headerlink" title="3.[bzoj3998: TJOI2015]弦论"></a>3.[bzoj3998: <a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=3998">TJOI2015]弦论</a></h4><p><strong>求一个串的第K小子串</strong> ，<code>T==0</code> 表示不同位置的相同子串算作一个，<code>T==1</code> 则表示不同位置的相同子串算作多个。</p>
<p>还是先计算 $endpos$ 集合大小cnt，如果 <code>T==0</code>，则每个状态cnt值都是1，如果 <code>T==1</code>，则还是和之前的代码一样，在suffix link构成的树上做拓扑排序，转移出cnt。</p>
<p>另外还需要知道从每个状态往后走会有多少种子串，记为 $Sum[x]$，还是用同样的拓扑序转移</p>
<p>$$<br>Sum[x]&#x3D;cnt[x]+\sum_{i&#x3D;0}^{25} Sum[son[x][i]]<br>$$</p>
<p>然后从根开始按照字典序dfs一下就可以求出第K小子串了。</p>
<h4 id="4-bzoj3238-AHOI2013-差异"><a href="#4-bzoj3238-AHOI2013-差异" class="headerlink" title="4.[bzoj3238: AHOI2013]差异"></a>4.[bzoj3238: <a target="_blank" rel="noopener" href="https://www.lydsy.com/JudgeOnline/problem.php?id=3238">AHOI2013]差异</a></h4><p>给一个字符串S，求$\sum_{1\le i&lt;j\le n} len(T_i)+len(T_j)-2lcp(T_i,T_j)$，其中 $T_i$ 表示 $i$ 开始的后缀，$lcp$ 表示最长公共前缀。</p>
<p>把原串倒过来建后缀自动机，这样就把前缀变成了后缀。<strong>两个前缀的最长公共后缀是对应后缀自动机上两结点的LCA</strong> ，实上统计的话，枚举LCA做类似树dp的事情数一数即可。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addedge</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>;i&lt;=tot;++i)<br>        e[pre[i]].<span class="hljs-built_in">push_back</span>(i);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>    ll now=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;e[x].<span class="hljs-built_in">size</span>();++i)<br>    &#123;<br>        <span class="hljs-type">int</span> y=e[x][i];<br>        <span class="hljs-built_in">dfs</span>(y);<br>        ans-=<span class="hljs-number">2LL</span>*now*cnt[y]*maxlen[x];<br>        now+=cnt[y];<br>    &#125;<br>    <span class="hljs-keyword">if</span>(cnt[x]==<span class="hljs-number">1</span>) ans-=<span class="hljs-number">2</span>*now*maxlen[x];<br>    cnt[x]+=now;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>或者这样，类似容斥一下的统计</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs inform7">void dfs(int x)<br>&#123;<br>    for(int i=0;i&lt;e<span class="hljs-comment">[x]</span>.size();++i)<br>    &#123;<br>        int y=e<span class="hljs-comment">[x]</span><span class="hljs-comment">[i]</span>;<br>        dfs(y);<br>        cnt<span class="hljs-comment">[x]</span>+=cnt<span class="hljs-comment">[y]</span>;<br>    &#125;<br>    if(x!=1) ans-=1LL*cnt<span class="hljs-comment">[x]</span>*(cnt<span class="hljs-comment">[x]</span>-1)*(maxlen<span class="hljs-comment">[x]</span>-maxlen<span class="hljs-comment">[pre<span class="hljs-comment">[x]</span>]</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="5-是男人就过-8-题–Pony-AI-A-String-Game"><a href="#5-是男人就过-8-题–Pony-AI-A-String-Game" class="headerlink" title="5.是男人就过 8 题–Pony.AI A String Game"></a>5.<a target="_blank" rel="noopener" href="https://nanti.jisuanke.com/t/24852">是男人就过 8 题–Pony.AI A String Game</a></h4><p>Alice和Bob玩游戏，有 $n$ 个串$S_i$，保证都是 $t$ 的子串，每人轮流从 $n$ 个串中取出一个串，并在结尾添加一个字符后放回去，要求是添加字符之后也要保证该串是 $t$ 的子串，无法操作的人输，Alice先手，问谁赢。</p>
<p>显然是要在 $t$ 的后缀自动机上博弈，要注意不能直接从根开始dfs，需要先做搞出拓扑序。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">calc</span><span class="hljs-params">(<span class="hljs-type">char</span> *s,<span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> now=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;++i)<br>        now=son[now][s[i]-<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-keyword">return</span> ans[now];<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">work</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=tot;++i)<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">26</span>;++j)<br>            <span class="hljs-keyword">if</span>(son[i][j])<br>            &#123;<br>                e[son[i][j]].<span class="hljs-built_in">push_back</span>(i);<br>                in[i]++;<br>            &#125;<br>    <span class="hljs-type">int</span> l=<span class="hljs-number">0</span>,r=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=tot;++i)<br>        <span class="hljs-keyword">if</span>(!in[i])<br>            q[r++]=i;<br>    <span class="hljs-keyword">while</span>(l!=r)<br>    &#123;<br>        <span class="hljs-type">int</span> x=q[l++];<br>        <span class="hljs-type">int</span> now=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(vis[x][now]) ++now;<br>        ans[x]=now;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> &amp;y:e[x])<br>        &#123;<br>            vis[y][ans[x]]=<span class="hljs-literal">true</span>;<br>            --in[y];<br>            <span class="hljs-keyword">if</span>(!in[y])<br>                q[r++]=y;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="6-bzoj1396-识别子串"><a href="#6-bzoj1396-识别子串" class="headerlink" title="6.bzoj1396: 识别子串"></a>6.<a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1396">bzoj1396: 识别子串</a></h4><p>给一个串，求每个位置的最短识别子串的长度，最短识别子串定义是，在整个串中出现一次且覆盖到这个位置的最短的一个子串。</p>
<p>做法是找$endpos$集合大小为 $1$ 的那些串，用线段树维护答案，具体是区间和一个数取min，以及和一个等差数列取min，稍微转化一下就很好写了。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/" class="category-chain-item">算法学习</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA/">#后缀自动机</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>后缀自动机学习笔记</div>
      <div>https://izard.space/2018/08/18/后缀自动机学习笔记/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>forever_you</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2018年8月18日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2018/08/28/%E7%B1%BB%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/" title="类欧几里得算法">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">类欧几里得算法</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2018/06/22/%E8%AF%97%E8%AF%8D%E4%B8%A4%E9%A6%96/" title="诗词两首">
                        <span class="hidden-mobile">诗词两首</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<!-- hexo injector body_end start --><script>pseudocode.renderClass("pseudocode");</script><!-- hexo injector body_end end --></body>
</html>
